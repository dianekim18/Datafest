---
title: "covid19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-packages}
library(tidyverse)
library("dplyr")
library(stringr)
library(RCurl)
```
```{r load-data}
date_of_study = "04-19-2020"

covid_hist = read.csv(text=getURL("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports/03-30-2020.csv"))
covid_us_hist = subset(covid_hist, Country_Region == "US" & is.na(FIPS)==F)

covid = read.csv(text=getURL(paste0("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports/",date_of_study,".csv")))
covid_us = subset(covid,Country_Region == "US" & is.na(FIPS)!=T)
covid_us = rbind(covid_us,subset(covid_us_hist, (!(FIPS %in% covid_us$FIPS))  & Confirmed == 0 & Deaths == 0 & is.na(FIPS)==F))

county_pm = read.csv(text=getURL("https://raw.githubusercontent.com/wxwx1993/PM_COVID/master/Data/county_pm25.csv"))

pm_ave <- read_csv("county_pm_ave.csv")

dem <- read_csv("co-est2019-alldata.csv")


```

```{r clean-up-data}
county_pm %>%
  count(fips)

covid_us <- covid_us %>%
  mutate(fips = FIPS)

aggregate( fips ~ pm25, county_pm, mean )
  
full <- inner_join(covid_us, county_pm, by = "fips")
```

```{r deaths-proportion}
covid_us <- covid_us %>%
  group_by(Admin2) %>%
  mutate(deaths_prop = Deaths/Confirmed)
```

